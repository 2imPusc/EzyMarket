# ðŸ”„ Forgot Password Flow Diagram

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚         â”‚   Backend    â”‚         â”‚   Email     â”‚
â”‚  (Browser)  â”‚         â”‚   (Node.js)  â”‚         â”‚   Service   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                       â”‚
       â”‚  POST /forgot-password â”‚                       â”‚
       â”‚  { email }             â”‚                       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚                        â”‚  Find User by Email   â”‚
       â”‚                        â”‚                       â”‚
       â”‚                        â”‚  Generate JWT Token   â”‚
       â”‚                        â”‚  (expires in 1 hour)  â”‚
       â”‚                        â”‚                       â”‚
       â”‚                        â”‚  Send Email           â”‚
       â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                        â”‚                       â”‚
       â”‚  { message: "Email     â”‚                       â”‚
       â”‚    sent successfully" }â”‚                       â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚                        â”‚                       â”‚  ðŸ“§ Email
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  with link
       â”‚                        â”‚                       â”‚
       â”‚  User clicks link      â”‚                       â”‚
       â”‚  in email              â”‚                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚  GET /verify-reset-token                       â”‚
       â”‚  ?token=xxx            â”‚                       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚                        â”‚  Verify JWT Token     â”‚
       â”‚                        â”‚                       â”‚
       â”‚  { valid: true,        â”‚                       â”‚
       â”‚    email: "..." }      â”‚                       â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚  User enters new       â”‚                       â”‚
       â”‚  password              â”‚                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚  POST /reset-password  â”‚                       â”‚
       â”‚  ?token=xxx            â”‚                       â”‚
       â”‚  { newPassword }       â”‚                       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚                        â”‚  Verify Token         â”‚
       â”‚                        â”‚  Find User            â”‚
       â”‚                        â”‚  Hash Password        â”‚
       â”‚                        â”‚  Update DB            â”‚
       â”‚                        â”‚  Clear refreshToken   â”‚
       â”‚                        â”‚                       â”‚
       â”‚  { message: "Password  â”‚                       â”‚
       â”‚    reset successfully" }â”‚                      â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚  POST /login           â”‚                       â”‚
       â”‚  { email, newPassword }â”‚                       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
       â”‚                        â”‚                       â”‚
       â”‚  { token, refreshToken }                       â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
       â”‚                        â”‚                       â”‚
```

## Detailed Step-by-Step Flow

### Phase 1: Request Reset Password

```
User                    Controller                  Service                     Database
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚  1. POST /forgot-pwd     â”‚                          â”‚                            â”‚
 â”‚  { email }               â”‚                          â”‚                            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  2. Extract email        â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  3. Find user by email   â”‚                            â”‚
 â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  4. User data            â”‚                            â”‚
 â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  5. sendResetPasswordEmail()                          â”‚
 â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚  6. Generate JWT token     â”‚
 â”‚                          â”‚                          â”‚     (1 hour expiry)        â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚  7. Create reset URL       â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚  8. Send email             â”‚
 â”‚                          â”‚                          â”‚     (via nodemailer)       â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  9. Email sent           â”‚                            â”‚
 â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚  10. Success response    â”‚                          â”‚                            â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
```

### Phase 2: Verify Token (Optional)

```
User                    Controller                  Service                     Database
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚  1. GET /verify-token    â”‚                          â”‚                            â”‚
 â”‚     ?token=xxx           â”‚                          â”‚                            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  2. Extract token        â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  3. verifyResetToken()   â”‚                            â”‚
 â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚  4. jwt.verify()           â”‚
 â”‚                          â”‚                          â”‚     - Check signature      â”‚
 â”‚                          â”‚                          â”‚     - Check expiry         â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  5. { valid, decoded }   â”‚                            â”‚
 â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  6. Find user by ID      â”‚                            â”‚
 â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  7. User data            â”‚                            â”‚
 â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚  8. Token valid response â”‚                          â”‚                            â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
```

### Phase 3: Reset Password

```
User                    Controller                  Service                     Database
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚  1. POST /reset-pwd      â”‚                          â”‚                            â”‚
 â”‚     ?token=xxx           â”‚                          â”‚                            â”‚
 â”‚     { newPassword }      â”‚                          â”‚                            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  2. Extract token & pwd  â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  3. Validate password    â”‚                            â”‚
 â”‚                          â”‚     (min 6 chars)        â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  4. verifyResetToken()   â”‚                            â”‚
 â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚  5. jwt.verify()           â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  6. { valid, decoded }   â”‚                            â”‚
 â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  7. Find user by ID      â”‚                            â”‚
 â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  8. User data            â”‚                            â”‚
 â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  9. Update password      â”‚                            â”‚
 â”‚                          â”‚     user.password = new  â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  10. Clear refreshToken  â”‚                            â”‚
 â”‚                          â”‚      user.refreshToken=null                           â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  11. Save user           â”‚                            â”‚
 â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚  12. Pre-save hook         â”‚
 â”‚                          â”‚                          â”‚      - Hash password       â”‚
 â”‚                          â”‚                          â”‚      - bcrypt.hash()       â”‚
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚                          â”‚  13. Saved successfully  â”‚                            â”‚
 â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                          â”‚                          â”‚                            â”‚
 â”‚  14. Success response    â”‚                          â”‚                            â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚                            â”‚
 â”‚                          â”‚                          â”‚                            â”‚
```

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ROUTES                                â”‚
â”‚                    (authRoute.js)                             â”‚
â”‚                                                                â”‚
â”‚  POST   /api/auth/forgot-password                             â”‚
â”‚  GET    /api/auth/verify-reset-token                          â”‚
â”‚  POST   /api/auth/reset-password                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Route to Controller
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTROLLER                               â”‚
â”‚                  (authController.js)                          â”‚
â”‚                                                                â”‚
â”‚  â€¢ forgotPassword()      - Request reset email                â”‚
â”‚  â€¢ verifyResetToken()    - Validate token                     â”‚
â”‚  â€¢ resetPassword()       - Update password                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Call Services
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVICES                                â”‚
â”‚                  (forgotPassword.js)                          â”‚
â”‚                                                                â”‚
â”‚  â€¢ sendResetPasswordEmail() - Generate token & send email     â”‚
â”‚  â€¢ verifyResetToken()       - Verify JWT token                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â†“               â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    EMAIL     â”‚ â”‚     JWT      â”‚ â”‚   DATABASE   â”‚
â”‚   (Gmail)    â”‚ â”‚  (jsonwebtoken)â”‚ â”‚  (MongoDB)   â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ sendEmail()  â”‚ â”‚ jwt.sign()   â”‚ â”‚ User.find()  â”‚
â”‚              â”‚ â”‚ jwt.verify() â”‚ â”‚ User.save()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY MEASURES                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. TOKEN GENERATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ jwt.sign({                           â”‚
   â”‚   id: user._id,                      â”‚
   â”‚   email: user.email                  â”‚
   â”‚ },                                   â”‚
   â”‚ process.env.PASSWORD_RESET_KEY,      â”‚ â† Separate secret key
   â”‚ { expiresIn: '1h' }                  â”‚ â† Time-limited
   â”‚ )                                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. TOKEN VERIFICATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ jwt.verify(                          â”‚
   â”‚   token,                             â”‚
   â”‚   process.env.PASSWORD_RESET_KEY     â”‚ â† Must match
   â”‚ )                                    â”‚
   â”‚                                      â”‚
   â”‚ Checks:                              â”‚
   â”‚ âœ“ Valid signature                    â”‚
   â”‚ âœ“ Not expired                        â”‚
   â”‚ âœ“ Correct format                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. PASSWORD HASHING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Pre-save hook in User model:         â”‚
   â”‚                                      â”‚
   â”‚ const salt = bcrypt.genSalt(10)      â”‚
   â”‚ user.password = bcrypt.hash(         â”‚
   â”‚   password,                          â”‚
   â”‚   salt                               â”‚
   â”‚ )                                    â”‚
   â”‚                                      â”‚
   â”‚ Automatic on user.save()             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. SESSION INVALIDATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ After password reset:                â”‚
   â”‚                                      â”‚
   â”‚ user.refreshToken = null             â”‚ â† Force re-login
   â”‚ user.save()                          â”‚
   â”‚                                      â”‚
   â”‚ All existing sessions invalidated    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ERROR SCENARIOS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. FORGOT PASSWORD
   â”œâ”€ Email not provided â†’ 400 "Email is required"
   â”œâ”€ User not found     â†’ 200 "If email exists..." (no disclosure)
   â””â”€ Email send fails   â†’ 500 "Internal server error"

2. VERIFY TOKEN
   â”œâ”€ No token           â†’ 400 "Token is required"
   â”œâ”€ Invalid token      â†’ 400 "Invalid or expired token"
   â”œâ”€ Expired token      â†’ 400 "Invalid or expired token"
   â””â”€ User not found     â†’ 404 "User not found"

3. RESET PASSWORD
   â”œâ”€ No token           â†’ 400 "Reset token is required"
   â”œâ”€ No password        â†’ 400 "New password is required"
   â”œâ”€ Password too short â†’ 400 "Password must be at least 6 chars"
   â”œâ”€ Invalid token      â†’ 400 "Invalid or expired reset token"
   â”œâ”€ User not found     â†’ 404 "User not found"
   â””â”€ Save fails         â†’ 500 "Internal server error"
```

## Data Flow

```
REQUEST                    PROCESSING                    RESPONSE
========                   ==========                    ========

{ email }         â†’  Find in DB                  â†’  { message }
                     Generate token
                     Send email

?token=xxx        â†’  Verify JWT                  â†’  { valid, email }
                     Check expiry
                     Find user

{ newPassword }   â†’  Verify token                â†’  { message }
?token=xxx           Validate password
                     Hash password
                     Update DB
                     Clear session
```

## File Structure

```
EzyMarket/
â””â”€â”€ src/
    â”œâ”€â”€ routes/
    â”‚   â””â”€â”€ authRoute.js              â† 3 new routes
    â”‚
    â”œâ”€â”€ controllers/
    â”‚   â””â”€â”€ authController.js         â† 3 new methods
    â”‚
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ forgotPassword.js         â† NEW FILE
    â”‚   â””â”€â”€ verifyEmail.js            â† Updated
    â”‚
    â”œâ”€â”€ utils/
    â”‚   â””â”€â”€ sendEmail.js              â† Existing
    â”‚
    â””â”€â”€ model/
        â””â”€â”€ userRepository.js         â† Existing (pre-save hook)
```
