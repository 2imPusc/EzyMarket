# EzyMarket Backend - Data Flow & Integration Diagrams

## ğŸ”„ Complete User Journey Flows

### 1. User Registration & Email Verification Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REGISTRATION FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User Registers
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend sends: POST /api/user/register                 â”‚
â”‚ {                                                       â”‚
â”‚   email: "user@example.com",                            â”‚
â”‚   userName: "john_doe",                                 â”‚
â”‚   password: "securePassword"                            â”‚
â”‚ }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authRoute.js â†’ authController.register()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validation (validationMiddleware)                        â”‚
â”‚ â”œâ”€ Check email format                                   â”‚
â”‚ â”œâ”€ Check password strength                              â”‚
â”‚ â””â”€ Check username uniqueness                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authService.handleRegister()                             â”‚
â”‚ â”œâ”€ Check if email exists in MongoDB                      â”‚
â”‚ â”œâ”€ Hash password with bcryptjs (10 rounds)              â”‚
â”‚ â””â”€ Create User document                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ userRepository.create()                                  â”‚
â”‚ {                                                        â”‚
â”‚   email: "user@example.com",                             â”‚
â”‚   userName: "john_doe",                                  â”‚
â”‚   password: "$2a$10$...(hashed)",                        â”‚
â”‚   emailVerified: false,                                  â”‚
â”‚   createdAt: ISODate(),                                  â”‚
â”‚   profile: {}                                            â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB: users collection                                â”‚
â”‚ âœ“ Document inserted successfully                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
Step 2: Automatic Email Verification
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ verifyEmail.sendVerificationEmail()                      â”‚
â”‚ â”œâ”€ Generate OTP (6 digits)                               â”‚
â”‚ â”œâ”€ Save OTP with 10-minute expiration                    â”‚
â”‚ â””â”€ Send email via Nodemailer                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Email Service (Nodemailer)                               â”‚
â”‚ â”œâ”€ Connect to SMTP server                                â”‚
â”‚ â”œâ”€ Send email with OTP: 123456                           â”‚
â”‚ â””â”€ Return success/failure                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response to Frontend (201 Created)                        â”‚
â”‚ {                                                        â”‚
â”‚   success: true,                                         â”‚
â”‚   message: "Check your email for verification",          â”‚
â”‚   userId: "mongo_object_id"                              â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
Step 3: User Receives Email
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks email link or enters OTP manually            â”‚
â”‚                                                          â”‚
â”‚ POST /api/user/verify-email                             â”‚
â”‚ {                                                        â”‚
â”‚   email: "user@example.com",                             â”‚
â”‚   otp: "123456"                                          â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ verifyEmail.verifyOTP()                                  â”‚
â”‚ â”œâ”€ Find user by email                                    â”‚
â”‚ â”œâ”€ Check OTP validity                                    â”‚
â”‚ â”œâ”€ Check OTP expiration                                  â”‚
â”‚ â””â”€ Update user.emailVerified = true                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB: Update user document                            â”‚
â”‚ db.users.updateOne(                                      â”‚
â”‚   { email: "user@example.com" },                         â”‚
â”‚   { $set: { emailVerified: true } }                      â”‚
â”‚ )                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response (200 OK)                                        â”‚
â”‚ {                                                        â”‚
â”‚   success: true,                                         â”‚
â”‚   message: "Email verified successfully"                 â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            âœ“ Account Ready for Login
```

### 2. Login & Token Generation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOGIN FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User Login
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/user/login                                     â”‚
â”‚ {                                                        â”‚
â”‚   email: "user@example.com",                             â”‚
â”‚   password: "securePassword"                             â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ validationMiddleware: Validate email & password fields   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authController.login()                                   â”‚
â”‚ â”œâ”€ Extract email & password from req.body               â”‚
â”‚ â””â”€ Call authService.login()                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authService.login()                                      â”‚
â”‚ â”œâ”€ Query: userRepository.findOne({ email })             â”‚
â”‚ â””â”€ If not found: return 404 error                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB: users collection search                         â”‚
â”‚ db.users.findOne({ email: "user@example.com" })        â”‚
â”‚ Returns: { _id, email, password: "hashed", ... }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authService: Compare passwords                           â”‚
â”‚ â”œâ”€ bcryptjs.compare(plaintextPassword, hashedPassword)  â”‚
â”‚ â”œâ”€ If not match: return 401 Unauthorized                â”‚
â”‚ â””â”€ If match: continue to token generation               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authService.generateAccessToken()                        â”‚
â”‚ â”œâ”€ Create JWT payload:                                   â”‚
â”‚ â”‚  { userId: "...", email: "...", role: "..." }        â”‚
â”‚ â”œâ”€ Sign with JWT_SECRET                                 â”‚
â”‚ â”œâ”€ Expiration: 1 hour                                    â”‚
â”‚ â””â”€ Return: accessToken                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authService.generateRefreshToken()                       â”‚
â”‚ â”œâ”€ Create JWT payload (similar)                          â”‚
â”‚ â”œâ”€ Expiration: 7 days                                    â”‚
â”‚ â””â”€ Return: refreshToken                                  â”‚
â”‚ (Optional: Save refreshToken to MongoDB for tracking)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response (200 OK)                                        â”‚
â”‚ {                                                        â”‚
â”‚   success: true,                                         â”‚
â”‚   accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6...",     â”‚
â”‚   refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6...",    â”‚
â”‚   user: {                                                â”‚
â”‚     _id: "user123",                                      â”‚
â”‚     email: "user@example.com",                           â”‚
â”‚     userName: "john_doe",                                â”‚
â”‚     role: "user"                                         â”‚
â”‚   }                                                      â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
          âœ“ Frontend saves tokens in localStorage
          âœ“ Subsequent requests include accessToken
```

### 3. Recipe Creation with Nested Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               RECIPE CREATION FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Frontend sends Recipe Data
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/recipes                                        â”‚
â”‚ Authorization: Bearer {accessToken}                      â”‚
â”‚ {                                                        â”‚
â”‚   title: "Pasta Carbonara",                              â”‚
â”‚   description: "...",                                    â”‚
â”‚   groupId: "group123",                                   â”‚
â”‚   servings: 4,                                           â”‚
â”‚   prepTime: 10,                                          â”‚
â”‚   cookTime: 20,                                          â”‚
â”‚   difficulty: "medium",                                  â”‚
â”‚   ingredients: [                                         â”‚
â”‚     {                                                    â”‚
â”‚       ingredientId: "ingredient123",                     â”‚
â”‚       quantity: 400,                                     â”‚
â”‚       unitId: "unit123"                                  â”‚
â”‚     }                                                    â”‚
â”‚   ],                                                     â”‚
â”‚   cookingSteps: [                                        â”‚
â”‚     {                                                    â”‚
â”‚       stepNumber: 1,                                     â”‚
â”‚       description: "Boil pasta",                         â”‚
â”‚       duration: 15                                       â”‚
â”‚     }                                                    â”‚
â”‚   ],                                                     â”‚
â”‚   tags: ["tag123", "tag456"]                             â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ recipeRoute.js â†’ authMiddleware                          â”‚
â”‚ â”œâ”€ Extract JWT token from header                        â”‚
â”‚ â”œâ”€ Verify token signature & expiration                  â”‚
â”‚ â””â”€ Extract userId from token payload                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ groupMiddleware                                          â”‚
â”‚ â”œâ”€ Check if user is member of group                     â”‚
â”‚ â””â”€ Check if user has permission to create recipes       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ validationMiddleware                                     â”‚
â”‚ â”œâ”€ Validate recipe schema with Joi                      â”‚
â”‚ â”œâ”€ Check required fields                                â”‚
â”‚ â””â”€ Validate data types & constraints                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ recipeController.createRecipe()                          â”‚
â”‚ â”œâ”€ Extract data from request body                       â”‚
â”‚ â”œâ”€ Enrich with userId & timestamp                       â”‚
â”‚ â””â”€ Call recipeService.createRecipe()                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ recipeService.createRecipe()                             â”‚
â”‚ â”œâ”€ Validate ingredients exist                           â”‚
â”‚ â”œâ”€ Validate units exist                                 â”‚
â”‚ â”œâ”€ Validate tags exist                                  â”‚
â”‚ â”œâ”€ Calculate total cooking time                         â”‚
â”‚ â””â”€ Call recipeRepository.create()                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ recipeRepository.create()                                â”‚
â”‚ â”œâ”€ Build Recipe document:                               â”‚
â”‚ â”‚  {                                                    â”‚
â”‚ â”‚    _id: new ObjectId(),                               â”‚
â”‚ â”‚    title: "Pasta Carbonara",                           â”‚
â”‚ â”‚    owner: ObjectId(userId),                            â”‚
â”‚ â”‚    group: ObjectId(groupId),                           â”‚
â”‚ â”‚    ingredients: [                                      â”‚
â”‚ â”‚      {                                                â”‚
â”‚ â”‚        ingredient: ObjectId(ingredientId),             â”‚
â”‚ â”‚        quantity: 400,                                  â”‚
â”‚ â”‚        unit: ObjectId(unitId)                          â”‚
â”‚ â”‚      }                                                â”‚
â”‚ â”‚    ],                                                 â”‚
â”‚ â”‚    cookingSteps: [...],                                â”‚
â”‚ â”‚    tags: [ObjectId(tag1), ObjectId(tag2)],            â”‚
â”‚ â”‚    createdAt: ISODate()                                â”‚
â”‚ â”‚  }                                                    â”‚
â”‚ â””â”€ MongoDB insert operation                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB: recipes collection                              â”‚
â”‚ db.recipes.insertOne({...document...})                   â”‚
â”‚ Returns: { acknowledged: true, insertedId: "..." }      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ recipeRepository.populate()                              â”‚
â”‚ â”œâ”€ Populate owner: User details                          â”‚
â”‚ â”œâ”€ Populate ingredients.ingredient: Ingredient details  â”‚
â”‚ â”œâ”€ Populate ingredients.unit: Unit details               â”‚
â”‚ â”œâ”€ Populate tags: Tag details                            â”‚
â”‚ â””â”€ Populate group: Group details                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB: Multiple find queries for population            â”‚
â”‚ â”œâ”€ db.users.findOne({ _id: ownerId })                  â”‚
â”‚ â”œâ”€ db.ingredients.find({ _id: {...} })                 â”‚
â”‚ â”œâ”€ db.units.find({ _id: {...} })                       â”‚
â”‚ â”œâ”€ db.tags.find({ _id: {...} })                        â”‚
â”‚ â””â”€ Returns populated recipe object                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response (201 Created)                                   â”‚
â”‚ {                                                        â”‚
â”‚   success: true,                                         â”‚
â”‚   message: "Recipe created successfully",                â”‚
â”‚   recipe: {                                              â”‚
â”‚     _id: "recipe123",                                    â”‚
â”‚     title: "Pasta Carbonara",                            â”‚
â”‚     owner: {                                             â”‚
â”‚       _id: "user123",                                    â”‚
â”‚       userName: "john_doe"                               â”‚
â”‚     },                                                   â”‚
â”‚     group: "group123",                                   â”‚
â”‚     ingredients: [                                       â”‚
â”‚       {                                                  â”‚
â”‚         ingredient: {                                    â”‚
â”‚           _id: "ingredient123",                          â”‚
â”‚           name: "Pasta"                                  â”‚
â”‚         },                                               â”‚
â”‚         quantity: 400,                                   â”‚
â”‚         unit: {                                          â”‚
â”‚           _id: "unit123",                                â”‚
â”‚           name: "gram"                                   â”‚
â”‚         }                                                â”‚
â”‚       }                                                  â”‚
â”‚     ],                                                   â”‚
â”‚     cookingSteps: [...],                                 â”‚
â”‚     tags: [...],                                         â”‚
â”‚     createdAt: "2024-01-08T10:00:00Z"                   â”‚
â”‚   }                                                      â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        âœ“ Recipe created and visible to group
```

### 4. Shopping List Generation from Meal Plan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SHOPPING LIST GENERATION FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User requests shopping list generation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/shopping-lists/generate-from-plan              â”‚
â”‚ Authorization: Bearer {accessToken}                      â”‚
â”‚ {                                                        â”‚
â”‚   mealPlanId: "mealPlan123",                             â”‚
â”‚   groupId: "group123"                                    â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Middleware Stack:                                        â”‚
â”‚ â”œâ”€ authMiddleware: Verify JWT                            â”‚
â”‚ â”œâ”€ groupMiddleware: Verify group access                  â”‚
â”‚ â””â”€ validationMiddleware: Validate input                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ shoppingController.generateFromMealPlan()                â”‚
â”‚ â””â”€ Call shoppingService.generateFromMealPlan()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ shoppingService.generateFromMealPlan()                   â”‚
â”‚ â”œâ”€ Step 1: Fetch meal plan from MongoDB                  â”‚
â”‚ â”‚  db.mealplans.findOne({ _id: mealPlanId })            â”‚
â”‚ â”‚  Returns: { meals: [...], ... }                        â”‚
â”‚ â””â”€ Next step: Extract recipes                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fetch all recipes from meal plan                         â”‚
â”‚ â”œâ”€ For each meal in meal plan:                           â”‚
â”‚ â”‚  db.recipes.findOne({ _id: meal.recipeId })           â”‚
â”‚ â”‚  Returns: { ingredients: [...], ... }                 â”‚
â”‚ â””â”€ Collect all ingredient arrays                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aggregate ingredients from all recipes                   â”‚
â”‚ â”œâ”€ Initialize: ingredientMap = {}                        â”‚
â”‚ â”œâ”€ For each recipe's ingredients:                        â”‚
â”‚ â”‚  â”œâ”€ ingredientId = ingredient._id                      â”‚
â”‚ â”‚  â”œâ”€ If ingredientId exists in map:                     â”‚
â”‚ â”‚  â”‚  â””â”€ Add quantity to existing: qty += recipe.qty     â”‚
â”‚ â”‚  â””â”€ Else: Create new entry                             â”‚
â”‚ â””â”€ Result: Consolidated ingredient list                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check fridge inventory for availability                  â”‚
â”‚ â”œâ”€ Query: fridgeItems where group = groupId              â”‚
â”‚ â”‚  db.fridgeitems.find({ group: groupId })              â”‚
â”‚ â”œâ”€ For each shopping item:                               â”‚
â”‚ â”‚  â”œâ”€ Check if item exists in fridge                     â”‚
â”‚ â”‚  â”œâ”€ Check expiry date (if expiring soon)               â”‚
â”‚ â”‚  â””â”€ Mark as "need to buy" or "check quantity"          â”‚
â”‚ â””â”€ Filter out items already in fridge (optional)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Shopping List document                            â”‚
â”‚ â”œâ”€ Build shopping list structure:                        â”‚
â”‚ â”‚  {                                                     â”‚
â”‚ â”‚    _id: new ObjectId(),                                â”‚
â”‚ â”‚    group: ObjectId(groupId),                           â”‚
â”‚ â”‚    name: "Shopping for week of Jan 8",                 â”‚
â”‚ â”‚    items: [                                            â”‚
â”‚ â”‚      {                                                 â”‚
â”‚ â”‚        ingredient: ObjectId(ingredientId),             â”‚
â”‚ â”‚        quantity: 1500,  (aggregated qty)               â”‚
â”‚ â”‚        unit: ObjectId(unitId),                         â”‚
â”‚ â”‚        isPurchased: false,                             â”‚
â”‚ â”‚        purchasedBy: null,                              â”‚
â”‚ â”‚        notes: ""                                       â”‚
â”‚ â”‚      },                                                â”‚
â”‚ â”‚      ...                                               â”‚
â”‚ â”‚    ],                                                  â”‚
â”‚ â”‚    status: "active",                                   â”‚
â”‚ â”‚    createdBy: ObjectId(userId),                        â”‚
â”‚ â”‚    createdAt: ISODate()                                â”‚
â”‚ â”‚  }                                                     â”‚
â”‚ â””â”€ Call shoppingRepository.create()                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB: shoppinglists collection                         â”‚
â”‚ db.shoppinglists.insertOne({...document...})             â”‚
â”‚ Returns: { acknowledged: true, insertedId: "shopping123" }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Populate shopping list response                          â”‚
â”‚ â”œâ”€ Populate ingredients.ingredient: Ingredient details   â”‚
â”‚ â”œâ”€ Populate ingredients.unit: Unit details               â”‚
â”‚ â”œâ”€ Populate createdBy: User details                      â”‚
â”‚ â””â”€ Calculate totals (items, cost estimate)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response (201 Created)                                   â”‚
â”‚ {                                                        â”‚
â”‚   success: true,                                         â”‚
â”‚   message: "Shopping list generated successfully",        â”‚
â”‚   shoppingList: {                                        â”‚
â”‚     _id: "shopping123",                                  â”‚
â”‚     name: "Shopping for week of Jan 8",                  â”‚
â”‚     items: [                                             â”‚
â”‚       {                                                  â”‚
â”‚         _id: "item123",                                  â”‚
â”‚         ingredient: {                                    â”‚
â”‚           _id: "ingredient123",                          â”‚
â”‚           name: "Pasta",                                 â”‚
â”‚           category: "grain"                              â”‚
â”‚         },                                               â”‚
â”‚         quantity: 1500,                                  â”‚
â”‚         unit: { _id, name, abbreviation },              â”‚
â”‚         isPurchased: false                               â”‚
â”‚       }                                                  â”‚
â”‚     ],                                                   â”‚
â”‚     status: "active",                                    â”‚
â”‚     itemCount: 15,                                       â”‚
â”‚     purchasedCount: 0                                    â”‚
â”‚   }                                                      â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
     âœ“ Group can now share & track purchases
```

---

## ğŸ”Œ External Service Integrations

### Email Service (Nodemailer) Integration

```
Application Layer
    â†“
sendEmail.js (Email utility)
    â”œâ”€ Configure SMTP transport
    â”‚  â”œâ”€ Host: SMTP_HOST (from .env)
    â”‚  â”œâ”€ Port: SMTP_PORT
    â”‚  â”œâ”€ User: SMTP_USER
    â”‚  â””â”€ Password: SMTP_PASSWORD
    â”‚
    â””â”€ sendMail(to, subject, htmlContent)
       â”œâ”€ Create email body
       â”œâ”€ Send via Nodemailer
       â””â”€ Return success/error status
         â†“
    Nodemailer Library
         â”œâ”€ Create transport
         â”œâ”€ Verify SMTP connection
         â””â”€ Send email
           â†“
    Email Provider (Gmail, SendGrid, AWS SES, etc)
         â”œâ”€ Receive email
         â”œâ”€ Process delivery
         â””â”€ Send to recipient
           â†“
    User's Email Inbox
```

### File Upload (UploadThing) Integration

```
Frontend (with file)
    â”‚
    â”œâ”€ Select image (recipe, profile, etc)
    â””â”€ Send to /api/uploadthing/upload
         â†“
uploadRouter.js
    â”œâ”€ Receive multipart form-data
    â””â”€ Call UploadThing SDK
         â†“
uploadthing.js (Configuration)
    â”œâ”€ Configure API key & secret
    â”œâ”€ Define upload routes/buckets
    â””â”€ Set file size limits & types
         â†“
UploadThing Service (External)
    â”œâ”€ Validate file type & size
    â”œâ”€ Scan for malware (optional)
    â”œâ”€ Store in cloud (AWS S3/CloudFront)
    â””â”€ Return public URL
         â†“
Application
    â”œâ”€ Save URL in MongoDB
    â””â”€ Return URL to frontend
         â†“
Frontend/Client
    â””â”€ Display image using returned URL
```

---

## ğŸ“Š Database Relationships Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONGODB COLLECTIONS & RELATIONSHIPS              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

users
â”œâ”€ _id
â”œâ”€ email
â”œâ”€ userName
â”œâ”€ password
â”œâ”€ role: "user" | "admin"
â”œâ”€ emailVerified
â”œâ”€ profile: {name, avatar, bio}
â”œâ”€ groups: [Reference to Group]
â”œâ”€ recipes: [Reference to Recipe]
â”œâ”€ createdAt
â””â”€ updatedAt

        â†‘ owns
        â”‚
        â”œâ”€ can create
        â”‚
groups
â”œâ”€ _id
â”œâ”€ name
â”œâ”€ description
â”œâ”€ owner: Reference to User
â”œâ”€ members: [{
â”‚   userId: Reference to User,
â”‚   role: "owner" | "admin" | "member",
â”‚   joinedAt: Date
â”‚ }]
â”œâ”€ ingredients: [Reference to Ingredient]
â”œâ”€ recipes: [Reference to Recipe]
â”œâ”€ mealPlans: [Reference to MealPlan]
â”œâ”€ shoppingLists: [Reference to Shopping]
â”œâ”€ createdAt
â””â”€ updatedAt

        â”œâ”€ contains
        â”‚
        â”œâ”€ units â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ â”œâ”€ _id               â”‚
        â”‚ â”œâ”€ name              â”‚
        â”‚ â”œâ”€ abbreviation      â”‚
        â”‚ â”œâ”€ conversionFactor  â”‚
        â”‚ â”œâ”€ type (volume, weight, etc)
        â”‚ â”œâ”€ group: Reference to Group
        â”‚ â”œâ”€ createdAt         â”‚
        â”‚ â””â”€ updatedAt         â”‚
        â”‚                      â”‚
        â”‚ ingredients          â”‚ uses
        â”‚ â”œâ”€ _id               â”‚
        â”‚ â”œâ”€ name              â”‚
        â”‚ â”œâ”€ category          â”‚
        â”‚ â”œâ”€ unit: Reference â”€â”€â”˜
        â”‚ â”œâ”€ group: Reference to Group
        â”‚ â”œâ”€ createdAt
        â”‚ â””â”€ updatedAt
        â”‚         â†‘ contains
        â”‚         â”‚
        â”œâ”€ recipes
        â”‚ â”œâ”€ _id
        â”‚ â”œâ”€ title
        â”‚ â”œâ”€ description
        â”‚ â”œâ”€ owner: Reference to User
        â”‚ â”œâ”€ group: Reference to Group
        â”‚ â”œâ”€ ingredients: [{
        â”‚ â”‚   ingredient: Reference
        â”‚ â”‚   quantity: Number
        â”‚ â”‚   unit: Reference
        â”‚ â”‚ }]
        â”‚ â”œâ”€ cookingSteps: [{
        â”‚ â”‚   stepNumber
        â”‚ â”‚   description
        â”‚ â”‚   duration
        â”‚ â”‚ }]
        â”‚ â”œâ”€ tags: [Reference to Tag]
        â”‚ â”œâ”€ cuisineType
        â”‚ â”œâ”€ servings
        â”‚ â”œâ”€ prepTime
        â”‚ â”œâ”€ cookTime
        â”‚ â”œâ”€ difficulty
        â”‚ â”œâ”€ ratings: [{
        â”‚ â”‚   userId: Reference to User
        â”‚ â”‚   rating: 1-5
        â”‚ â”‚   review: String
        â”‚ â”‚ }]
        â”‚ â”œâ”€ likes: [Reference to User]
        â”‚ â”œâ”€ image: String (URL)
        â”‚ â”œâ”€ isPublic: Boolean
        â”‚ â”œâ”€ createdAt
        â”‚ â””â”€ updatedAt
        â”‚         â”‚ tagged with
        â”‚         â”œâ”€ tags
        â”‚         â”‚ â”œâ”€ _id
        â”‚         â”‚ â”œâ”€ name
        â”‚         â”‚ â”œâ”€ group: Reference to Group
        â”‚         â”‚ â”œâ”€ createdAt
        â”‚         â”‚ â””â”€ updatedAt
        â”‚         â”‚
        â”‚         â””â”€ used in
        â”‚             mealPlans
        â”‚             â”œâ”€ _id
        â”‚             â”œâ”€ name
        â”‚             â”œâ”€ group: Reference to Group
        â”‚             â”œâ”€ meals: [{
        â”‚             â”‚   date: Date
        â”‚             â”‚   mealType: "breakfast"|"lunch"|etc
        â”‚             â”‚   recipe: Reference
        â”‚             â”‚   servings: Number
        â”‚             â”‚   assignedTo: [Reference to User]
        â”‚             â”‚ }]
        â”‚             â”œâ”€ startDate
        â”‚             â”œâ”€ endDate
        â”‚             â”œâ”€ createdBy: Reference to User
        â”‚             â”œâ”€ createdAt
        â”‚             â””â”€ updatedAt
        â”‚
        â””â”€ fridgeItems
          â”œâ”€ _id
          â”œâ”€ ingredient: Reference
          â”œâ”€ quantity: Number
          â”œâ”€ unit: Reference
          â”œâ”€ expiryDate: Date
          â”œâ”€ location: "fridge" | "freezer" | "pantry"
          â”œâ”€ addedBy: Reference to User
          â”œâ”€ status: "fresh" | "expiring" | "expired"
          â”œâ”€ createdAt
          â””â”€ updatedAt

        â””â”€ shoppingLists
          â”œâ”€ _id
          â”œâ”€ name
          â”œâ”€ group: Reference to Group
          â”œâ”€ items: [{
          â”‚   _id: ObjectId
          â”‚   ingredient: Reference
          â”‚   quantity: Number
          â”‚   unit: Reference
          â”‚   isPurchased: Boolean
          â”‚   purchasedBy: Reference to User
          â”‚   purchasedAt: Date
          â”‚   notes: String
          â”‚ }]
          â”œâ”€ status: "draft" | "active" | "completed"
          â”œâ”€ createdBy: Reference to User
          â”œâ”€ createdAt
          â””â”€ updatedAt
```

---

## ğŸ” Security Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            JWT TOKEN VERIFICATION FLOW                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client Request
â”œâ”€ Include: Authorization: Bearer {token}
â””â”€ Headers

        â†“
Express Middleware Chain
â”œâ”€ Extract token from header
â””â”€ Pass to authMiddleware

        â†“
authMiddleware.js
â”œâ”€ Verify JWT signature
â”‚  â””â”€ Use JWT_SECRET to decode & validate
â”œâ”€ Check token expiration
â”‚  â””â”€ Compare current time with exp claim
â”œâ”€ Extract payload:
â”‚  â””â”€ userId, email, role, etc
â””â”€ Store in req.user for next middleware

        â†“
groupMiddleware.js (if required)
â”œâ”€ Check if user is in group
â””â”€ Query: db.groups.findOne({
           _id: groupId,
           members.userId: userId
         })

        â†“
ownershipMiddleware.js (if required)
â”œâ”€ Check if user owns resource
â””â”€ Query: db.recipes.findOne({
           _id: resourceId,
           owner: userId
         })

        â†“
Resource Access Granted âœ“
â””â”€ Continue to controller & service layers
```

---

## ğŸ”„ Caching & Performance Considerations

```
Potential Optimization Points:

1. User Profile Caching (Redis)
   - Cache user details in memory
   - Invalidate on profile updates
   - TTL: 1 hour

2. Recipe Listing (Pagination)
   - Use skip/limit in queries
   - Index: { group: 1, createdAt: -1 }

3. Group Aggregations
   - Use MongoDB aggregation pipeline
   - Cache frequently accessed stats
   - Example: Total recipes, members count

4. Tag Autocomplete
   - Cache tag list per group
   - Update on tag creation/deletion

5. Search Optimization
   - Text indexes on recipe title & description
   - Index: { title: "text", description: "text" }

6. Database Indexing Strategy
   indexes: {
     users: [
       { email: 1 } (unique),
       { userName: 1 } (unique)
     ],
     groups: [
       { owner: 1 },
       { members.userId: 1 }
     ],
     recipes: [
       { group: 1, createdAt: -1 },
       { owner: 1 },
       { title: "text", description: "text" }
     ],
     ingredients: [
       { group: 1, name: 1 }
     ],
     fridgeitems: [
       { group: 1, expiryDate: 1 }
     ],
     shoppinglists: [
       { group: 1, status: 1, createdAt: -1 }
     ]
   }
```

---

## ğŸ“Š Monitoring & Logging

```
Application Events to Monitor:

1. Authentication Events
   â”œâ”€ Login attempts (success/failure)
   â”œâ”€ Token refresh
   â”œâ”€ Password resets
   â””â”€ Email verification

2. Data Operations
   â”œâ”€ Recipe CRUD operations
   â”œâ”€ Shopping list generation
   â”œâ”€ Ingredient/Unit modifications
   â””â”€ Fridge item changes

3. Performance Metrics
   â”œâ”€ Query execution time
   â”œâ”€ API response time
   â”œâ”€ Database connection pool usage
   â””â”€ Memory usage

4. Error Tracking
   â”œâ”€ 4xx client errors
   â”œâ”€ 5xx server errors
   â”œâ”€ Unhandled exceptions
   â””â”€ Validation failures

Logging Tools (Recommended):
â”œâ”€ Winston (Node.js logging)
â”œâ”€ Morgan (HTTP request logging)
â”œâ”€ Sentry (Error tracking)
â””â”€ DataDog (APM & monitoring)
```

---

**Last Updated**: January 2026
**Version**: 1.0.0
